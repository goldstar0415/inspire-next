<%= simple_form_for [@channel,@message], :html => { :class => 'form-horizontal' } do |f| %>
  <%= f.input :type, collection: user_message_types, include_blank:false, readonly: @message.new_record? ? false : true%>
  <%= f.input :caption , label: 'Message Text', input_html: {rows:5}, hint:"Total message length:#{total_message_length(@message)}" %>
  <%= f.input :content %>
  <% if @channel.individual_messages_have_schedule? %>
    <% if @channel.relative_schedule %>
      <%= render :partial=>'shared/relative_schedule',:locals=>{f:f} %>
    <% else %>
      <%= f.input :next_send_time, :as => :datetime_picker %>
    <% end %>
  <% end %>
  <%= render :partial=>'messages/editor/reminder_section', :locals=>{f:f} %>
  <%= render :partial=>'messages/editor/message_type_specific_section', :locals=>{f:f} %>
  <%= f.input :active, hint:'Making inactive will skip during scheduled send' %>

  <div class="form-actions">
    <%= f.button :submit, :class => 'btn-primary' %>
    <%= link_to 'Cancel',request.referer, :class => 'btn' %>
  </div>
<% end %>

<% content_for :head_js do %>
  <script type="text/javascript">
    function updateTotalLength(){
      var base_length = <%=base_message_length(@message) %>
      $("div.message_caption .help-block").text("Total message length:"+(($("#message_caption").val()).length+base_length))
    }
    $(document).ready(function(){
      updateTotalLength();
      $("#message_caption").keyup(function(event){
        updateTotalLength();
      })
    });
  </script>
<% end %>
